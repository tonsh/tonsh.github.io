<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
        <title>Python 里的字符串赋值</title>
        <meta name="viewport" content="width=device-width" />

        <link rel="stylesheet" href="/css/bootstrap/css/bootstrap.min.css" />
        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/css/syntax.css" />

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css" />
        
        <!-- RSS -->
        <link rel="alternate" type="application/rss+xml" title="Tonsh's Blog" href="http://tonsh.github.io/feed.xml" />

        <!-- icon -->
        <link rel="icon" href="/favicon.ico" type="image/x-icon" />

    </head>

    <body>
      <div class="site">
        <div class="header">
  <h1 class="title"><a href="/">Tonsh's Blog</a></h1>
</div>

<div class="nav">
  <div class="nav-block">
      <a class="item" href="/">Home</a>
      <a class="item" href="/about">About</a>
  </div>
</div>


<h2 class="post-title">Python 里的字符串赋值</h2>
<p class="meta">21 Nov 2013</p>

<div class="post">
<p>字符串类型是 Python 的内置类型，Python 中字符串的赋值过程发生过哪些事情？</p>

<div class="highlight"><pre><code class="bash">&gt;&gt;&gt; <span class="nv">a</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span>
&gt;&gt;&gt; <span class="nv">b</span> <span class="o">=</span> a
&gt;&gt;&gt; id<span class="o">(</span>a<span class="o">)</span>
4464547200
&gt;&gt;&gt; <span class="nv">b</span> <span class="o">=</span> a
&gt;&gt;&gt; id<span class="o">(</span>b<span class="o">)</span>
4464547200
&gt;&gt;&gt; a is b
True
&gt;&gt;&gt; <span class="nv">b</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>
&gt;&gt;&gt; id<span class="o">(</span>b<span class="o">)</span>
4464546880
&gt;&gt;&gt; id<span class="o">(</span>a<span class="o">)</span>
4464547200
&gt;&gt;&gt; a
a
&gt;&gt;&gt; b
b
</code></pre></div>

<p>当变量 b 初次赋值时，并没有立即分配内存，而是与 a 指向了相同的内存空间；<br/>
若 a 或 b 任意一个值改变时, 被改变的变量指向的内存空间会变化；</p>

<p>如果增加字符串的长度呢？</p>

<div class="highlight"><pre><code class="bash">&gt;&gt;&gt; <span class="nv">a</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span>
&gt;&gt;&gt; id<span class="o">(</span>a<span class="o">)</span>
4464547200
&gt;&gt;&gt; a +<span class="o">=</span> <span class="s1">&#39;b&#39;</span>
&gt;&gt;&gt; id<span class="o">(</span>a<span class="o">)</span>
4465546784
&gt;&gt;&gt; a +<span class="o">=</span> <span class="s1">&#39;c&#39;</span>
&gt;&gt;&gt; id<span class="o">(</span>a<span class="o">)</span>
4465546784
</code></pre></div>

<p>第一次修改字符串 a 时，a 的长度加 1，理论上应该多分配 1 个字符的空间，但是Python会额外多分配的空间比实际需要的要多（公式换算），如果之后继续增加a的长度，a 指向的地址并没有变化，直到首次分配的空间占满后，a 的地址才会变化，下面给些数据，大家感受一下：</p>

<div class="highlight"><pre><code class="python"><span class="lineno"> 1</span> <span class="n">a</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
<span class="lineno"> 2</span> <span class="n">aid</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="lineno"> 3</span> 
<span class="lineno"> 4</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50000</span><span class="p">):</span>
<span class="lineno"> 5</span>     <span class="n">a</span> <span class="o">+=</span> <span class="s">&#39;a&#39;</span>
<span class="lineno"> 6</span>     <span class="n">aid_2</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="lineno"> 7</span> 
<span class="lineno"> 8</span>     <span class="k">if</span> <span class="n">aid_2</span> <span class="o">!=</span> <span class="n">aid</span><span class="p">:</span>
<span class="lineno"> 9</span>         <span class="k">print</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<span class="lineno">10</span>         <span class="n">aid</span> <span class="o">=</span> <span class="n">aid_2</span>
</code></pre></div>

<p>输出结果：</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">1
2
4
12
20
28
36
44
52
60
68
76
84
92
100
108
116
124
132
140
148
156
164
172
180
188
196
204
212
220
236
284
636
652
668
684
972
988
2012
2524
4572
36316
36828
37340
37852
38364
</code></pre></div>
</div>

<!-- Duoshuo Comment BEGIN -->
	<div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"tonsh"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- Duoshuo Comment END -->



        <div class="footer">
          <div class="container">
            <p class="text-muted credit">
              Power by <a href="https://github.com/mojombo/jekyll" target="_blank">Jekyll</a> & <a href="https://github.com" target="_blank">GitHub</a>&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;Copyright &copy; 2013 by tonsh
            </p>
          </div>
        </div>
      </div>
    </body>
</html>
